fontface = 'bold',
angle =90)
FigC_label = plot_grid(y_lab, FigC_plot,
NULL, x_lab,
ncol = 2,
rel_widths = c(0.05, 0.95),
rel_heights = c(0.95, 0.05))
FigC_label
ggsave(file.path(fig_dir, 'FigureC_deming_filters.jpg'),
dpi = 300,
height = 10,
width = 10,
units = 'in')
FigC_label = plot_grid(y_lab, FigC_plot,
NULL, x_lab,
ncol = 2,
rel_widths = c(0.05, 1),
rel_heights = c(1, 0.05))
FigC_label
FigC_label = plot_grid(y_lab, FigC_plot,
NULL, x_lab,
ncol = 2,
rel_widths = c(0.05, 1.1),
rel_heights = c(1.1, 0.05))
FigC_label
ggsave(file.path(fig_dir, 'FigureC_deming_filters.jpg'),
dpi = 300,
height = 10,
width = 10,
units = 'in')
# by insitu temp
istemp <- ggplot(C2ST_kurtosis, aes(x = is_temp_med, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
labs(x = 'in-situ median water temp\n(deg C)',
y = '\n') +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
final_theme
istemp
# by doy
doy <- ggplot(C2ST_kurtosis, aes(x = as.numeric(doy), y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
labs(x = 'day of year\n',
y = '\n') +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
final_theme
doy
# by pixel count
perclake <- ggplot(C2ST_kurtosis, aes(x = (pixel_count/17134)*100, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
labs(x = 'percent of lake\n',
y = '\n') +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
final_theme
perclake
# by kurtosis cover
cloud <- ggplot(C2ST_kurtosis, aes(x = cloud_cover, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'cloud cover (percent)\n',
y = '\n') +
final_theme
cloud
# by sun elevation
sunelev <- ggplot(C2ST_kurtosis, aes(x = elev, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'sun elevation (UNITS)\n',
y = 'Deming-optimized residual\n(deg C)') +
final_theme
sunelev
# by earth sun distance
esd <- ggplot(C2ST_kurtosis, aes(x = esd, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'earth sun distance (UNITS)\n',
y = '\n') +
final_theme
esd
# by azimuth
azi <- ggplot(C2ST_kurtosis, aes(x = azimuth, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'sun azimuth (degrees)\n',
y = '\n') +
final_theme
azi
# depth of sensor
depth <- ggplot(C2ST_kurtosis, aes(x = is_depth_avg, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'average depth of sensor (m)\n',
y = '\n') +
final_theme
depth
# std dev in-situ temp
sd <- ggplot(C2ST_kurtosis, aes(x = is_temp_stdev, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'standard deviation of temps\ncontributing to median (deg C)',
y = '\n') +
final_theme
sd
#in-situ count
count <- ggplot(C2ST_kurtosis, aes(x = insitu_count, y = opt_resid)) +
geom_point() +
# geom_line(aes(group = date)) +
geom_abline(intercept =  0, slope = 0) +
coord_cartesian(ylim = c(-5, 5)) +
labs(x = 'number of insitu measurements\ncontributing to median',
y = '\n') +
final_theme
count
plot_grid(istemp, doy, perclake, cloud, sunelev, esd, azi, depth, sd, count,
labels = c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'),
ncol = 2,
label_x = 0.07,
label_y = 1)
ggsave(file.path(fig_dir, 'SFA_resid_summary_C2kurtosis_v12Nov2021.jpg'),
height = 12, width = 8, units = 'in', dpi = 300)
# Calculate error for various models ####
alldata_error <- all_surface_temp %>%
group_by(collection, filter) %>%
summarise(mse = round(sum((opt_resid^2))/n(), digits = 2),
rmse = round(sqrt(mse), digits = 2),
bias = round(sum(opt_resid)/n(), digits = 2),
mae = round(sum(abs(opt_resid))/n(), digits = 2),
n_obs = n())  %>%
mutate(month = 'All data',
LSmission = 'All missions') %>%
pivot_longer(cols = c(mse:n_obs), names_to = 'variable', values_to = 'values') %>%
mutate(variable = factor(variable, levels = c('n_obs', 'mae', 'rmse', 'mse', 'bias'))) %>%
arrange(month, variable) %>%
pivot_wider(names_from = c(LSmission),
values_from = values)
mission_error <- all_surface_temp %>%
group_by(collection, LSmission, filter) %>%
summarise(mse = round(sum((opt_resid^2))/n(), digits = 2),
rmse = round(sqrt(mse), digits = 2),
bias = round(sum(opt_resid)/n(), digits = 2),
mae = round(sum(abs(opt_resid))/n(), digits = 2),
n_obs = n())  %>%
mutate(month = 'All data') %>%
pivot_longer(cols = c(mse:n_obs), names_to = 'variable', values_to = 'values') %>%
mutate(variable = factor(variable, levels = c('n_obs', 'mae', 'rmse', 'mse', 'bias'))) %>%
arrange(month, variable) %>%
pivot_wider(names_from = c(LSmission),
values_from = values)
alldata_error <- full_join(alldata_error, mission_error)
alldata_error
month_mission_error <- all_surface_temp %>%
group_by(collection, month, LSmission, filter) %>%
summarise(mse = round(sum((opt_resid^2))/n(), digits = 2),
rmse = round(sqrt(mse), digits = 2),
bias = round(sum(opt_resid)/n(), digits = 2),
mae = round(sum(abs(opt_resid))/n(), digits = 2),
n_obs = n())  %>%
select(month, collection, LSmission, filter,n_obs, mae, rmse, bias) %>%
pivot_longer(!c(month, LSmission, collection, filter), names_to = 'variable', values_to = 'values') %>%
mutate(variable = factor(variable, levels = c('n_obs', 'mae', 'rmse', 'mse', 'bias'))) %>%
arrange(month, variable) %>%
pivot_wider(names_from = c(LSmission),
values_from = values)
month_error <- all_surface_temp %>%
group_by(collection, month, filter) %>%
summarise(mse = round(sum((opt_resid^2))/n(), digits = 2),
rmse = round(sqrt(mse), digits = 2),
bias = round(sum(opt_resid)/n(), digits = 2),
mae = round(sum(abs(opt_resid))/n(), digits = 2),
n_obs = n())  %>%
mutate(LSmission = 'All missions') %>%
select(month, collection, LSmission, filter, n_obs, mae, rmse, bias) %>%
pivot_longer(!c(month, LSmission, filter, collection), names_to = 'variable', values_to = 'values') %>%
mutate(variable = factor(variable, levels = c('n_obs', 'mae', 'rmse', 'mse', 'bias'))) %>%
arrange(month, variable) %>%
pivot_wider(names_from = c(LSmission),
values_from = values)
month_error <- full_join(month_mission_error, month_error)
alldata_error <- full_join(alldata_error, month_error)
write.csv(alldata_error, file.path(C2_datadir, 'LS_deming_predictionerror_C1C2_stats_v15Nov2021.csv'))
missionmonth_biasmae <- alldata_error %>%
filter(month != 'All data' & (variable == 'mae' | variable == 'bias')) %>%
select(-`All missions`) %>%
filter(collection == 2) %>%
pivot_longer(cols = c(`LS 5`:`LS 8`),
names_to = 'mission',
values_to = 'value') %>%
mutate(c_filter = paste0('C', collection, ' ', filter)) %>%
mutate(c_filter = factor(c_filter,
levels = c('C1 none', 'C1 kurtosis', 'C2 none', 'C2 kurtosis'),
labels = c('C1', 'C1 kurtosis', 'C2', 'C2 kurtosis')))
ggplot(missionmonth_biasmae, aes(x = month, y = value)) +
geom_point(aes(color = mission)) +
facet_grid(c_filter ~ variable)+
final_theme+
scale_color_colorblind()
FigGI_a <- missionmonth_biasmae %>%
filter(variable == 'bias' & c_filter == 'C2') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
labs(x = '',
y = '') +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
coord_cartesian(ylim = c(-2, 2)) +
final_theme+
theme(axis.title=element_text(size=10,face="bold")) +
theme(legend.position = 'none') +
scale_color_colorblind()
FigGI_a
FigGI_c <- missionmonth_biasmae %>%
filter(variable == 'bias' & c_filter == 'C2 kurtosis') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
labs(x = '',
y = '') +
final_theme+
coord_cartesian(ylim = c(-2, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
theme(legend.position = 'none') +
theme(axis.title=element_text(size=10,face="bold")) +
scale_color_colorblind()
FigGI_c
FigGI_b <- missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
labs(x = '',
y = '') +
final_theme+
theme(axis.title=element_text(size=10,face="bold")) +
theme(legend.position = 'none') +
scale_color_colorblind()
FigGI_b
FigGI_d <- missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
labs(x = '',
y = '') +
final_theme+
theme(axis.title=element_text(size=10,face="bold")) +
theme(legend.position = 'none') +
scale_color_colorblind()
FigGI_d
forlegend <- missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
full_join(month_list) %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
theme(legend.position = 'bottom') +
labs(x = 'month',
y = '\n') +
final_theme+
scale_color_colorblind()
leg <- get_legend(forlegend)
missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
full_join(month_list) %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
theme(legend.position = 'bottom') +
labs(x = 'month',
y = '\n') +
final_theme+
scale_color_colorblind()
missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
theme(legend.position = 'bottom') +
labs(x = 'month',
y = '\n') +
final_theme+
scale_color_colorblind()
forlegend <- missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
theme(legend.position = 'bottom') +
labs(x = 'month',
y = '\n') +
final_theme+
scale_color_colorblind()
leg <- get_legend(forlegend)
leg
figure_title_bias <- ggdraw() + draw_label('   bias', fontface = 'bold')
figure_title_mae <- ggdraw() + draw_label('   mean absolute error', fontface = 'bold')
figure_title <- plot_grid(figure_title_bias, figure_title_mae, nrow = 1)
figure_title
nofilter <- plot_grid(FigGI_a, FigGI_b,
ncol = 2)
nofilter_title <- ggdraw() + draw_label("Collection 2", fontface='bold')
nofilter <- plot_grid(nofilter_title, nofilter,
nrow = 2,
rel_heights = c(0.15, 0.85))
nofilter
kurtosis <- plot_grid(FigGI_c, FigGI_c,
ncol = 2)
kurtosis_title <- ggdraw() + draw_label("Collection 2 - kurtosis", fontface='bold')
kurtosis <- plot_grid(kurtosis_title, kurtosis,
nrow = 2,
rel_heights = c(0.15, 0.85))
kurtosis
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.2, 0.9, 0.9),
ncol =1)
FigGI
plot_grid(FigGI, leg, rel_widths = c(0.9,0.1 ))
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 0.9, 0.9),
ncol =1)
FigGI
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 1, 1),
ncol =1)
FigGI
plot_grid(FigGI, leg, rel_widths = c(0.9,0.1 ))
x_lab = ggdraw() + draw_label(label = 'month', fontface = 'bold')
FigGI_label = plot_grid(y_lab, FigGI,
NULL, x_lab,
rel_heights = c(0.9, 0.1),
rel_widths = c(0.1, 0.9))
FigGI_label
FigGI_label = plot_grid(y_lab, FigGI,
NULL, x_lab,
rel_heights = c(1.1, 0.05),
rel_widths = c(0.05, 1.1))
FigGI_label
plot_grid(FigGI, leg, rel_widths = c(0.9,0.1 ))
plot_grid(FigGI_label, leg, rel_widths = c(0.9,0.1 ))
ggsave(file.path(fig_dir, 'FigGI_errorbymission.jpg'), height = 10, width = 8, units = 'in', dpi = 300)
ggsave(file.path(fig_dir, 'FigGI_errorbymission.jpg'),
height = 6, width = 8, units = 'in', dpi = 300)
x_lab = ggdraw() + draw_label(label = 'month', fontface = 'bold')
y_lab = ggdraw() + draw_label(label = 'water temperature (deg C)',
angle = 90,
fontface = 'bold')
y_lab = ggdraw(NULL, xlab,
relheights = 0.5, 2)
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 1, 1),
ncol =1)
FigGI
FigGI_label = plot_grid(y_lab, FigGI,
NULL, x_lab,
rel_heights = c(1.1, 0.05),
rel_widths = c(0.05, 1.1))
FigGI_label
plot_grid(FigGI_label, leg, rel_widths = c(0.9,0.1 ))
ggsave(file.path(fig_dir, 'FigGI_errorbymission.jpg'),
height = 6, width = 8, units = 'in', dpi = 300)
missionmonth_biasmae %>%
filter(variable == 'mae' & c_filter == 'C2 kurtosis') %>%
ggplot(., aes(x = month, y = value)) +
geom_point(aes(shape = mission), size =2) +
coord_cartesian(ylim = c(0, 2)) +
geom_abline(intercept = 0,
slope = 0,
lty = 2) +
labs(x = '',
y = '') +
final_theme+
theme(axis.title=element_text(size=10,face="bold")) +
theme(legend.position = 'none') +
scale_color_colorblind()
nofilter <- plot_grid(FigGI_a, FigGI_b,
labels = c('a', 'b'),
ncol = 2)
nofilter_title <- ggdraw() + draw_label("Collection 2", fontface='bold')
nofilter <- plot_grid(nofilter_title, nofilter,
nrow = 2,
rel_heights = c(0.15, 0.85))
nofilter
kurtosis <- plot_grid(FigGI_c, FigGI_d,
labels = c('c', 'd'),
ncol = 2)
kurtosis_title <- ggdraw() + draw_label("Collection 2 - kurtosis", fontface='bold')
kurtosis <- plot_grid(kurtosis_title, kurtosis,
nrow = 2,
rel_heights = c(0.15, 0.85))
kurtosis
x_lab = ggdraw() + draw_label(label = 'month', fontface = 'bold')
y_lab = ggdraw() + draw_label(label = 'water temperature (deg C)',
angle = 90,
fontface = 'bold')
nofilter <- plot_grid(FigGI_a, FigGI_b,
labels = c('a', 'b'),
ncol = 2)
nofilter_title <- ggdraw() + draw_label("Collection 2", fontface='bold')
nofilter <- plot_grid(nofilter_title, nofilter,
nrow = 2,
rel_heights = c(0.1, 1))
nofilter
kurtosis <- plot_grid(FigGI_c, FigGI_d,
labels = c('c', 'd'),
ncol = 2)
kurtosis_title <- ggdraw() + draw_label("Collection 2 - kurtosis", fontface='bold')
kurtosis <- plot_grid(kurtosis_title, kurtosis,
nrow = 2,
rel_heights = c(0.1, 1))
kurtosis
x_lab = ggdraw() + draw_label(label = 'month', fontface = 'bold')
y_lab = ggdraw() + draw_label(label = 'water temperature (deg C)',
angle = 90,
fontface = 'bold')
y_lab = ggdraw(NULL, xlab,
relheights = 0.5, 2)
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 1, 1),
ncol =1)
FigGI
y_lab = ggdraw(NULL, xlab,
relheights = c(0.5, 2))
y_lab = ggdraw(NULL, xlab,
rel_heights = c(0.5, 2))
y_lab = plot_grid(NULL, xlab,
rel_heights = c(0.5, 2))
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 1, 1),
ncol =1)
FigGI
FigGI_label = plot_grid(y_lab, FigGI,
NULL, x_lab,
rel_heights = c(1.1, 0.05),
rel_widths = c(0.05, 1.1))
FigGI_label
plot_grid(FigGI_label, leg, rel_widths = c(0.9,0.1 ))
y_lab = ggdraw() + draw_label(label = 'water temperature (deg C)',
angle = 90,
fontface = 'bold')
y_lab = plot_grid(NULL, xlab,
rel_heights = c(0.5, 2))
y_lab = plot_grid(NULL, xlab,
ncol = 1,
rel_heights = c(0.5, 2))
y_lab = plot_grid('', xlab,
ncol = 1,
rel_heights = c(0.5, 2))
y_lab = ggdraw() + draw_label(label = 'water temperature (deg C)',
angle = 90,
fontface = 'bold')
FigGI <- plot_grid(figure_title,
nofilter,
kurtosis,
rel_heights = c(0.05, 1, 1),
ncol =1)
FigGI
FigGI_label = plot_grid(y_lab, FigGI,
NULL, x_lab,
rel_heights = c(1.1, 0.05),
rel_widths = c(0.05, 1.1))
FigGI_label
plot_grid(FigGI_label, leg, rel_widths = c(0.9,0.1 ))
ggsave(file.path(fig_dir, 'FigGI_errorbymission.jpg'),
height = 6, width = 8, units = 'in', dpi = 300)
